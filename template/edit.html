{% extends 'layout.html' %}

{% set title = gettext('Edit Post') ~ ': ' ~ post.id %}

{% block style %}
    <link rel="stylesheet" href="{{ url_for('static', filename = 'view.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'tag_editor.css') }}">
{% endblock %}

{% block body %}
    <div class="view-container">
        <form id="post-form" class="form form-lg" enctype="multipart/form-data" method="post">
            {{ form.hidden_tag() }}

            <span id="post-id" class="hidden">{{ post.id }}</span>

            <div class="input-group">
                <label
                    for="new_file"
                    title="{{ gettext('Select this usually when you found a better quality file.') }}"
                >
                    {{ gettext('Replace with') }}:
                </label>
                <input type="file" name="new_file">
            </div>

            <div class="input-group">
                <label for="directory">{{ gettext('Directory') }}:</label>
                <input
                    type="text"
                    name="directory"
                    value="{% if post.directory is not none %}{{ post.directory }}{% endif %}"
                >
            </div>

            <div class="input-group">
                <label for="op">{{ gettext('Poster') }}:</label>
                <input
                    type="text"
                    name="op"
                    value="{% if post.op is not none %}{{ post.op }}{% endif %}"
                >

                {% if post.is_hyperlink(post.op) %}
                    <a href="{{ post.op }}">{{ gettext('Open') }}</a>
                {% endif %}
            </div>

            <div class="input-group">
                <label for="src">{{ gettext('Source') }}:</label>
                <input
                    type="text"
                    name="src"
                    value="{% if post.src is not none %}{{ post.src }}{% endif %}"
                >

                {% if post.is_hyperlink(post.src) %}
                    <a href="{{ post.src }}">{{ gettext('Open') }}</a>
                {% endif %}
            </div>

            <div class="input-group">
                <label for="caption">{{ gettext('Caption') }}:</label>
                <textarea
                    name="caption"
                >
                    {%- if post.caption is not none -%}
                    {{ post.caption }}
                    {%- endif -%}
                </textarea>
            </div>

            <div class="input-group">
                <label for="tags">{{ gettext('Tags') }}:</label>

                <noscript>
                    <textarea name="tags"
                        {% if not (current_user.has_permission('tag:edit') or current_user.owns(post)) %}
                            disabled
                        {% endif %}>
                        {%- if post.tags is not none -%}
                            {{ post.tags | map(attribute = 'name') | join(' ') }}
                        {%- endif -%}
                    </textarea>
                </noscript>

                {% include 'frag/tag.html' %}
            </div>

            <div class="input-group">
                <label for="deleted">{{ gettext('Delete') }}:</label>
                <input type="checkbox" name="deleted" 
                {%-
                    if not (current_user.has_permission('post:delete') or current_user.owns(post))
                -%}
                    disabled
                {% endif %}>
            </div>

            <input type="submit" value="{{ gettext('Submit') }}">
        </form>

        {% include 'frag/content.html' %}
    </div>
{% endblock %}

{% block script %}
    <script src="{{ url_for('static', filename = 'js/show_tags.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/tag_handler.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/upload.js') }}"></script>
{% endblock %}
